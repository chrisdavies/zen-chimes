{"version":3,"sources":["app.js","clock.js","dom.js","editing-page.js","elite.js","events.js","load-audio.js","page.js","paused-page.js","playing-page.js","random-player.js","settings.js","init.js"],"names":["app","init","name","def","val","modules","module","console","log","totalSeconds","minutes","pad","i","toString","slice","setTime","Math","floor","seconds","secondsInMinute","clock","text","start","setTimeout","decSecond","timeout","events","trigger","reset","stop","clearTimeout","$","settingsStore","read","on","settings","selector","setProp","prop","undefined","arr","self","forEach","el","classes","getAttribute","split","hasClass","className","indexOf","removeClass","setAttribute","filter","cls","join","addClass","Array","prototype","call","document","querySelectorAll","length","apply","arguments","toArray","get","some","bind","css","style","txt","evt","handler","addEventListener","off","removeEventListener","append","html","insertAdjacentHTML","select","timeInput","e","preventDefault","parseInt","update","load","arg","callback","buildCallback","fn1","fn2","data","chain","fn","callbacks","push","cb","noop","getEvent","Elite","args","done","generateAudioTags","wav","audioHtml","map","w","monitorAudioStatus","updateProgress","loadCount","bar","width","audios","audio","checkReadyState","isDone","every","readyState","show","page","pg","loopRandom","playMultiple","random","nextLoop","playRandom","pause","timer","lastIndex","playOne","volume","currentTime","play","key","JSON","parse","localStorage","getItem","setItem","stringify"],"mappings":"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","file":"app.js","sourcesContent":["var app = (function () {\n  var modules = { };\n\n  function init (name, def) {\n    var val = def();\n    modules[name] = function () {\n      return val;\n    };\n\n    return val;\n  }\n\n  return function (name, def) {\n    if (def) {\n      modules[name] = function () {\n        return init(name, def);\n      };\n    } else {\n      var module = modules[name];\n      return module ? modules[name]() : console.log('Module ' + name + ' does not exist');\n    }\n  }\n})();\n","app('clock', function () {\n  var $ = app('dom'),\n      events = app('events'),\n      settingsStore = app('settings');\n\n  var minutes = settingsStore.read().minutes,\n      timeout,\n      seconds = totalSeconds(),\n      clock = $('.zen-clock');\n\n  events.on('paused', stop);\n\n  events.on('playing', start);\n\n  events.on('reset', reset);\n\n  events.on('settings-updated', function (settings) {\n    minutes = settings.minutes;\n    reset();\n  });\n\n  function totalSeconds() {\n    return (minutes || 10) * 60;\n  }\n\n  function pad(i) {\n    return ('00' + i.toString()).slice(-2);\n  }\n\n  function setTime() {\n    var minutes = Math.floor(seconds / 60),\n        secondsInMinute = (seconds % 60);\n    clock.text(pad(minutes) + ':' + pad(secondsInMinute));\n  }\n\n  function start () {\n    setTimeout(function decSecond () {\n      if (--seconds) {\n        setTime();\n        timeout = setTimeout(decSecond, 1000);\n      } else {\n        events.trigger('paused');\n        reset();\n      }\n    }, 0);\n  }\n\n  function stop () {\n    clearTimeout(timeout);\n  }\n\n  function reset() {\n    seconds = totalSeconds();\n    setTime();\n  }\n\n});\n","app('dom', function () {\n  return function (selector) {\n    var arr = Array.prototype.slice.call(document.querySelectorAll(selector), 0);\n\n    function setProp(prop, val) {\n      if (val === undefined) return arr[0] ? arr[0][prop] : undefined;\n\n      return self.forEach(function (el) {\n        el[prop] = val;\n      });\n    }\n\n    function classes (el) {\n      return (el.getAttribute('class') || '').split(/[^\\w\\-]+/g);\n    }\n\n    function hasClass (el, className) {\n      return classes(el).indexOf(className) >= 0;\n    }\n\n    function removeClass (className, el) {\n      el.setAttribute('class', classes(el).filter(function (cls) {\n        return cls !== className;\n      }).join(' '));\n    }\n\n    function addClass (className, el) {\n      if (!hasClass(el, className)) {\n        el.setAttribute('class', el.getAttribute('class') + ' ' + className);\n      }\n    }\n\n    var self = {\n      length: arr.length,\n\n      forEach: function () {\n        arr.forEach.apply(arr, arguments);\n        return self;\n      },\n\n      toArray: function () {\n        return arr;\n      },\n\n      get: function (i) {\n        return arr[i];\n      },\n\n      hasClass: function (cls) {\n        return arr.some(function (el) {\n          return hasClass(el, cls);\n        });\n      },\n\n      removeClass: function (cls) {\n        return self.forEach(removeClass.bind(null, cls));\n      },\n\n      addClass: function (cls) {\n        return self.forEach(addClass.bind(null, cls));\n      },\n\n      css: function (def) {\n        return self.forEach(function (el) {\n          for (var prop in def) {\n            el.style[prop] = def[prop];\n          }\n        });\n      },\n\n      text: function (txt) {\n        return setProp('textContent', txt);\n      },\n\n      val: function (txt) {\n        return setProp('value', txt);\n      },\n\n      on: function (evt, handler) {\n        return self.forEach(function (el) {\n          el.addEventListener(evt, handler);\n        });\n      },\n\n      off: function (evt, handler) {\n        return self.forEach(function (el) {\n          el.removeEventListener(evt, handler);\n        });\n      },\n\n      append: function (html) {\n        var el = arr[0];\n\n        el && el.insertAdjacentHTML('afterend', html);\n\n        return self;\n      },\n\n      select: function () {\n        var el = arr[0];\n\n        el && typeof(el.select) === 'function' && el.select();\n\n        return self;\n      }\n    };\n\n    return self;\n  };\n});\n","app('editing-page', function () {\n  var $ = app('dom'),\n      settingsStore = app('settings'),\n      settings = settingsStore.read(),\n      timeInput = $('input[name=time]');\n\n  timeInput.val(settings.minutes);\n\n  $('.settings-form').on('submit', function (e) {\n    e.preventDefault();\n    settings.minutes = parseInt(timeInput.val()) || 10;\n    settingsStore.update(settings);\n  });\n\n  return {\n    load: function () {\n      $('.editing-page input').select();\n    }\n  };\n});\n","app('elite', function () {\n  return function () {\n    var callbacks = [],\n        noop = function () { },\n        callback = noop;\n\n    return {\n      on: on,\n      off: off,\n      trigger: trigger\n    };\n\n    function trigger (arg) {\n      callback(arg);\n    }\n\n    function buildCallback(fn1, fn2) {\n      return function (data) {\n        fn1(data); fn2(data);\n      }\n    }\n\n    function chain(fn) {\n      callback = buildCallback(callback, fn);\n    }\n\n    function on(fn) {\n      callbacks.push(fn);\n      chain(fn);\n    }\n\n    function off(fn) {\n      callbacks = callbacks.filter(function (cb) {\n        return cb !== fn;\n      });\n\n      callback = noop;\n      callbacks.forEach(chain);\n    }\n  };\n});\n","app('events', function () {\n  var Elite = app('elite'),\n      events = {};\n\n  function getEvent(name) {\n    return events[name] || (events[name] = Elite());\n  }\n\n  return {\n    on: function (name, fn) {\n      getEvent(name).on(fn);\n    },\n\n    off: function (name, fn) {\n      getEvent(name).off(fn);\n    },\n\n    trigger: function (name, args) {\n      setTimeout(function () {\n        getEvent(name).trigger(args);\n      }, 0);\n    }\n  };\n});\n","app('load-audio', function () {\n  return function (done) {\n    var $ = app('dom');\n\n    generateAudioTags();\n\n    monitorAudioStatus();\n\n    function generateAudioTags() {\n      var wav = [\n        'c1',\n        'c2',\n        'c3',\n        'c4',\n        'c5',\n        'c6'\n      ];\n\n      var audioHtml = wav.map(function (w) {\n        return '<audio preload=\"auto\">' +\n          '<source src=\"audio/' + w + '.mp3\" />' +\n          '<source src=\"audio/' + w + '.wav\" />' +\n          '</audio>';\n      }).join('');\n\n      $('.zen-page').append(audioHtml);\n    }\n\n    function monitorAudioStatus() {\n      var audios = $('audio').toArray(),\n          bar = $('.loading-bar');\n\n      audios.forEach(function (audio) {\n        audio.load();\n      });\n\n      function updateProgress (loadCount) {\n        bar.css({\n          width: ((loadCount / audios.length) * 100) + '%'\n        });\n      }\n\n      setTimeout(function checkReadyState () {\n        var isDone = audios.every(function (audio) {\n          return audio.readyState > 3;\n        });\n\n        if (isDone) {\n          done();\n        } else {\n          updateProgress(audios.filter(function (audio) {\n            return audio.readyState > 3;\n          }).length);\n\n          setTimeout(checkReadyState, 100);\n        }\n      }, 100);\n\n    }\n  };\n});\n","app('page', function () {\n  return {\n    show: function (page) {\n      var $ = app('dom');\n\n      $('.active-page')\n        .removeClass('active-page')\n        .addClass('inactive-page');\n\n      $('.' + page)\n        .removeClass('inactive-page')\n        .addClass('active-page');\n\n      var pg = app(page);\n      pg && pg.load && pg.load();\n    }\n  }\n});\n","app('paused-page', function () {\n  var $ = app('dom'),\n      events = app('events'),\n      page = app('page');\n\n  events.on('paused', function () {\n    page.show('paused-page');\n  });\n\n  $('.btn-play').on('click', function () {\n    events.trigger('playing');\n    page.show('playing-page');\n  });\n});\n","app('playing-page', function () {\n  var $ = app('dom'),\n      page = app('page'),\n      events = app('events');\n\n  // Initialize page-components\n  app('clock');\n  app('random-player');\n\n  // Add event handlers\n  $('.btn-reset').on('click', function () {\n    events.trigger('reset');\n  });\n\n  $('.btn-pause').on('click', function () {\n    events.trigger('paused');\n  });\n\n  $('.btn-edit').on('click', function () {\n    page.show('editing-page');\n  });\n\n});\n","app('random-player', function () {\n  var $ = app('dom'),\n      events = app('events'),\n      lastIndex = 0,\n      timer;\n\n  events.on('paused', pause);\n  events.on('playing', loopRandom);\n\n  return {\n    play: loopRandom,\n    pause: pause\n  };\n\n  function loopRandom() {\n    var playMultiple = Math.random() > 0.7,\n        nextLoop = Math.floor(Math.random() * 5000) + 250;\n\n    playRandom();\n\n    playMultiple && setTimeout(playRandom, 50);\n\n    pause();\n    timer = setTimeout(loopRandom, nextLoop);\n  }\n\n  function pause () {\n    clearTimeout(timer);\n  }\n\n  function playRandom() {\n    var audios = $('audio');\n    var i = Math.floor(Math.random() * 1000) % audios.length;\n\n    if (lastIndex == i) {\n      i = ++i % audios.length;\n    }\n\n    lastIndex = i;\n    playOne(audios.get(i));\n  }\n\n  function playOne (audio) {\n    audio.volume = (Math.floor(Math.random() * 7) + 3) / 10;\n    audio.currentTime ? audio.currentTime = 0 : audio.play();\n  }\n\n});\n","app('settings', function () {\n  var key = 'settings',\n      events = app('events');\n\n  return {\n    read: function () {\n      return JSON.parse(localStorage.getItem(key) || '{ \"minutes\": 10 }');\n    },\n\n    update: function (settings) {\n      localStorage.setItem(key, JSON.stringify(settings));\n      events.trigger('settings-updated', settings);\n    }\n  };\n});\n","(function () {\n  var load = app('load-audio'),\n      page = app('page'),\n      events = app('events');\n\n  load(function () {\n    page.show('paused-page');\n  });\n\n  events.on('settings-updated', function () {\n    page.show('playing-page');\n  });\n})();\n"],"sourceRoot":"/source/"}