{"version":3,"sources":["app.js","clock.js","dom.js","editing-page.js","elite.js","events.js","load-audio.js","page.js","paused-page.js","playing-page.js","random-player.js","settings.js","init.js"],"names":["app","init","name","def","val","modules","module","console","log","totalSeconds","minutes","pad","i","toString","slice","setTime","Math","floor","seconds","secondsInMinute","clock","text","start","setTimeout","decSecond","timeout","done","reset","stop","clearTimeout","$","events","settingsStore","read","on","settings","selector","setProp","prop","undefined","arr","self","forEach","el","classes","getAttribute","split","hasClass","className","indexOf","removeClass","setAttribute","filter","cls","join","addClass","Array","prototype","call","document","querySelectorAll","length","apply","arguments","get","some","bind","css","style","txt","evt","handler","addEventListener","off","removeEventListener","append","html","insertAdjacentHTML","select","timeInput","e","preventDefault","parseInt","update","load","trigger","arg","callback","buildCallback","fn1","fn2","data","chain","fn","callbacks","push","cb","noop","getEvent","Elite","args","isFirefox","navigator","userAgent","toLowerCase","showUnsupportedMessage","loadAudio","incIfReady","audio","readyState","loadCount","wav","bar","width","audioHtml","map","w","target","show","page","pg","loopRandom","playMultiple","random","nextLoop","playRandom","pause","timer","audios","lastIndex","playOne","currentTime","play","key","JSON","parse","localStorage","getItem","setItem","stringify"],"mappings":"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","file":"app.js","sourcesContent":["var app = (function () {\n  var modules = { };\n\n  function init (name, def) {\n    var val = def();\n    modules[name] = function () {\n      return val;\n    };\n\n    return val;\n  }\n\n  return function (name, def) {\n    if (def) {\n      modules[name] = function () {\n        return init(name, def);\n      };\n    } else {\n      var module = modules[name];\n      return module ? modules[name]() : console.log('Module ' + name + ' does not exist');\n    }\n  }\n})();\n","app('clock', function () {\n  var $ = app('dom'),\n      events = app('events'),\n      settingsStore = app('settings');\n\n  var minutes = settingsStore.read().minutes,\n      timeout,\n      seconds = totalSeconds(),\n      clock = $('.zen-clock');\n\n  events.on('paused', stop);\n\n  events.on('playing', start);\n\n  events.on('reset', reset);\n\n  events.on('settings-updated', function (settings) {\n    minutes = settings.minutes;\n    reset();\n  });\n\n  function totalSeconds() {\n    return (minutes || 10) * 60;\n  }\n\n  function pad(i) {\n    return ('00' + i.toString()).slice(-2);\n  }\n\n  function setTime() {\n    var minutes = Math.floor(seconds / 60),\n        secondsInMinute = (seconds % 60);\n    clock.text(pad(minutes) + ':' + pad(secondsInMinute));\n  }\n\n  function start () {\n    setTimeout(function decSecond () {\n      if (--seconds) {\n        setTime();\n        timeout = setTimeout(decSecond, 1000);\n      } else {\n        done();\n        reset();\n      }\n    }, 0);\n  }\n\n  function stop () {\n    clearTimeout(timeout);\n  }\n\n  function reset() {\n    seconds = totalSeconds();\n    setTime();\n  }\n\n});\n","app('dom', function () {\n  return function (selector) {\n    var arr = Array.prototype.slice.call(document.querySelectorAll(selector), 0);\n\n    function setProp(prop, val) {\n      if (val === undefined) return arr[0] ? arr[0][prop] : undefined;\n\n      return self.forEach(function (el) {\n        el[prop] = val;\n      });\n    }\n\n    function classes (el) {\n      return (el.getAttribute('class') || '').split(/[^\\w\\-]+/g);\n    }\n\n    function hasClass (el, className) {\n      return classes(el).indexOf(className) >= 0;\n    }\n\n    function removeClass (className, el) {\n      el.setAttribute('class', classes(el).filter(function (cls) {\n        return cls !== className;\n      }).join(' '));\n    }\n\n    function addClass (className, el) {\n      if (!hasClass(el, className)) {\n        el.setAttribute('class', el.getAttribute('class') + ' ' + className);\n      }\n    }\n\n    var self = {\n      length: arr.length,\n\n      forEach: function () {\n        arr.forEach.apply(arr, arguments);\n        return self;\n      },\n\n      get: function (i) {\n        return arr[i];\n      },\n\n      hasClass: function (cls) {\n        return arr.some(function (el) {\n          return hasClass(el, cls);\n        });\n      },\n\n      removeClass: function (cls) {\n        return self.forEach(removeClass.bind(null, cls));\n      },\n\n      addClass: function (cls) {\n        return self.forEach(addClass.bind(null, cls));\n      },\n\n      css: function (def) {\n        return self.forEach(function (el) {\n          for (var prop in def) {\n            el.style[prop] = def[prop];\n          }\n        });\n      },\n\n      text: function (txt) {\n        return setProp('textContent', txt);\n      },\n\n      val: function (txt) {\n        return setProp('value', txt);\n      },\n\n      on: function (evt, handler) {\n        return self.forEach(function (el) {\n          el.addEventListener(evt, handler);\n        });\n      },\n\n      off: function (evt, handler) {\n        return self.forEach(function (el) {\n          el.removeEventListener(evt, handler);\n        });\n      },\n\n      append: function (html) {\n        var el = arr[0];\n\n        el && el.insertAdjacentHTML('afterend', html);\n\n        return self;\n      },\n\n      select: function () {\n        var el = arr[0];\n\n        el && typeof(el.select) === 'function' && el.select();\n\n        return self;\n      }\n    };\n\n    return self;\n  };\n});\n","app('editing-page', function () {\n  var $ = app('dom'),\n      settingsStore = app('settings'),\n      settings = settingsStore.read(),\n      timeInput = $('input[name=time]');\n\n  timeInput.val(settings.minutes);\n\n  $('.settings-form').on('submit', function (e) {\n    e.preventDefault();\n    settings.minutes = parseInt(timeInput.val()) || 10;\n    settingsStore.update(settings);\n  });\n\n  return {\n    load: function () {\n      $('.editing-page input').select();\n    }\n  };\n});\n","app('elite', function () {\n  return function () {\n    var callbacks = [],\n        noop = function () { },\n        callback = noop;\n\n    return {\n      on: on,\n      off: off,\n      trigger: trigger\n    };\n\n    function trigger (arg) {\n      callback(arg);\n    }\n\n    function buildCallback(fn1, fn2) {\n      return function (data) {\n        fn1(data); fn2(data);\n      }\n    }\n\n    function chain(fn) {\n      callback = buildCallback(callback, fn);\n    }\n\n    function on(fn) {\n      callbacks.push(fn);\n      chain(fn);\n    }\n\n    function off(fn) {\n      callbacks = callbacks.filter(function (cb) {\n        return cb !== fn;\n      });\n\n      callback = noop;\n      callbacks.forEach(chain);\n    }\n  };\n});\n","app('events', function () {\n  var Elite = app('elite'),\n      events = {};\n\n  function getEvent(name) {\n    return events[name] || (events[name] = Elite());\n  }\n\n  return {\n    on: function (name, fn) {\n      getEvent(name).on(fn);\n    },\n\n    off: function (name, fn) {\n      getEvent(name).off(fn);\n    },\n\n    trigger: function (name, args) {\n      setTimeout(function () {\n        getEvent(name).trigger(args);\n      }, 0);\n    }\n  };\n});\n","app('load-audio', function () {\n  return function (done) {\n    var $ = app('dom');\n\n    if (isFirefox()) {\n      showUnsupportedMessage();\n    } else {\n      loadAudio();\n    }\n\n    function isFirefox() {\n      return navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n    }\n\n    function showUnsupportedMessage() {\n      $('.loading-message').text('FireFox is unsupported. :/');\n    }\n\n    function loadAudio() {\n      var loadCount = 0,\n        wav = [\n          'c1',\n          'c2',\n          'c3',\n          'c4',\n          'c5',\n          'c6'\n        ];\n      \n      var audioHtml = wav.map(function (w) {\n        return '<audio preload=\"auto\">' +\n          '<source src=\"audio/' + w + '.mp3\" />' +\n          '<source src=\"audio/' + w + '.wav\" />' +\n          '</audio>';\n      }).join('');\n\n      var bar = $('.loading-bar');\n\n      $('.zen-page').append(audioHtml);\n\n      function incIfReady (audio) {\n        if (audio.readyState <= 3 || loadCount >= wav.length) return false;\n\n        ++loadCount;\n\n        bar.css({\n          width: ((loadCount / wav.length) * 100) + '%'\n        });\n\n        (loadCount >= wav.length) && done && done();\n\n        return true;\n      }\n\n      $('audio').on('canplay', function (e) {\n        incIfReady(e.target);\n      }).forEach(function (audio) {\n        audio.load();\n      });\n    }\n  };\n});\n","app('page', function () {\n  return {\n    show: function (page) {\n      var $ = app('dom');\n\n      $('.active-page')\n        .removeClass('active-page')\n        .addClass('inactive-page');\n\n      $('.' + page)\n        .removeClass('inactive-page')\n        .addClass('active-page');\n\n      var pg = app(page);\n      pg && pg.load && pg.load();\n    }\n  }\n});\n","app('paused-page', function () {\n  var $ = app('dom'),\n      events = app('events'),\n      page = app('page');\n\n  $('.btn-play').on('click', function () {\n    events.trigger('playing');\n    page.show('playing-page');\n  });\n});\n","app('playing-page', function () {\n  var $ = app('dom'),\n      page = app('page'),\n      events = app('events');\n\n  // Initialize page-components\n  app('clock');\n  app('random-player');\n\n  // Add event handlers\n  $('.btn-reset').on('click', function () {\n    events.trigger('reset');\n  });\n\n  $('.btn-pause').on('click', function () {\n    events.trigger('paused');\n    page.show('paused-page');\n  });\n\n  $('.btn-edit').on('click', function () {\n    page.show('editing-page');\n  });\n\n});\n","app('random-player', function () {\n  var $ = app('dom'),\n      events = app('events'),\n      lastIndex = 0,\n      timer;\n\n  events.on('paused', pause);\n  events.on('playing', loopRandom);\n\n  return {\n    play: loopRandom,\n    pause: pause\n  };\n\n  function loopRandom() {\n    var playMultiple = Math.random() > 0.7,\n        nextLoop = Math.floor(Math.random() * 5000) + 250;\n\n    playRandom();\n\n    playMultiple && setTimeout(playRandom, 50);\n\n    pause();\n    timer = setTimeout(loopRandom, nextLoop);\n  }\n\n  function pause () {\n    clearTimeout(timer);\n  }\n\n  function playRandom() {\n    var audios = $('audio');\n    var i = Math.floor(Math.random() * 1000) % audios.length;\n\n    if (lastIndex == i) {\n      i = ++i % audios.length;\n    }\n\n    lastIndex = i;\n    playOne(audios.get(i));\n  }\n\n  function playOne (audio) {\n    audio.currentTime ? audio.currentTime = 0 : audio.play();\n  }\n\n});\n","app('settings', function () {\n  var key = 'settings',\n      events = app('events');\n\n  return {\n    read: function () {\n      return JSON.parse(localStorage.getItem(key) || '{ \"minutes\": 10 }');\n    },\n\n    update: function (settings) {\n      localStorage.setItem(key, JSON.stringify(settings));\n      events.trigger('settings-updated', settings);\n    }\n  };\n});\n","(function () {\n  var load = app('load-audio'),\n      page = app('page'),\n      events = app('events');\n\n  load(function () {\n    page.show('paused-page');\n  });\n\n  events.on('settings-updated', function () {\n    page.show('playing-page');\n  });\n})();\n"],"sourceRoot":"/source/"}