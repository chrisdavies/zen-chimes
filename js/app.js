var app=function(){function n(n,e){var o=e();return t[n]=function(){return o},o}var t={};return function(e,o){if(!o){var r=t[e];return r?t[e]():console.log("Module "+e+" does not exist")}t[e]=function(){return n(e,o)}}}();app("clock",function(){function n(){return 60*(f||10)}function t(n){return("00"+n.toString()).slice(-2)}function e(){var n=Math.floor(s/60),e=s%60;l.text(t(n)+":"+t(e))}function o(){setTimeout(function n(){--s?(e(),u=setTimeout(n,1e3)):(done(),a())},0)}function r(){clearTimeout(u)}function a(){s=n(),e()}var u,i=app("dom"),c=app("events"),p=app("settings"),f=p.read().minutes,s=n(),l=i(".zen-clock");c.on("paused",r),c.on("playing",o),c.on("reset",a),c.on("settings-updated",function(n){f=n.minutes,a()})}),app("dom",function(){return function(n){function t(n,t){return void 0===t?u[0]?u[0][n]:void 0:i.forEach(function(e){e[n]=t})}function e(n){return(n.getAttribute("class")||"").split(/[^\w\-]+/g)}function o(n,t){return e(n).indexOf(t)>=0}function r(n,t){t.setAttribute("class",e(t).filter(function(t){return t!==n}).join(" "))}function a(n,t){o(t,n)||t.setAttribute("class",t.getAttribute("class")+" "+n)}var u=Array.prototype.slice.call(document.querySelectorAll(n),0),i={length:u.length,forEach:function(){return u.forEach.apply(u,arguments),i},toArray:function(){return u},get:function(n){return u[n]},hasClass:function(n){return u.some(function(t){return o(t,n)})},removeClass:function(n){return i.forEach(r.bind(null,n))},addClass:function(n){return i.forEach(a.bind(null,n))},css:function(n){return i.forEach(function(t){for(var e in n)t.style[e]=n[e]})},text:function(n){return t("textContent",n)},val:function(n){return t("value",n)},on:function(n,t){return i.forEach(function(e){e.addEventListener(n,t)})},off:function(n,t){return i.forEach(function(e){e.removeEventListener(n,t)})},append:function(n){var t=u[0];return t&&t.insertAdjacentHTML("afterend",n),i},select:function(){var n=u[0];return n&&"function"==typeof n.select&&n.select(),i}};return i}}),app("editing-page",function(){var n=app("dom"),t=app("settings"),e=t.read(),o=n("input[name=time]");return o.val(e.minutes),n(".settings-form").on("submit",function(n){n.preventDefault(),e.minutes=parseInt(o.val())||10,t.update(e)}),{load:function(){n(".editing-page input").select()}}}),app("elite",function(){return function(){function n(n){i(n)}function t(n,t){return function(e){n(e),t(e)}}function e(n){i=t(i,n)}function o(n){a.push(n),e(n)}function r(n){a=a.filter(function(t){return t!==n}),i=u,a.forEach(e)}var a=[],u=function(){},i=u;return{on:o,off:r,trigger:n}}}),app("events",function(){function n(n){return e[n]||(e[n]=t())}var t=app("elite"),e={};return{on:function(t,e){n(t).on(e)},off:function(t,e){n(t).off(e)},trigger:function(t,e){setTimeout(function(){n(t).trigger(e)},0)}}}),app("load-audio",function(){return function(n){function t(){var n=["c1","c2","c3","c4","c5","c6"],t=n.map(function(n){return'<audio preload="auto"><source src="audio/'+n+'.mp3" /><source src="audio/'+n+'.wav" /></audio>'}).join("");o(".zen-page").append(t)}function e(){function t(n){r.css({width:n/e.length*100+"%"})}var e=o("audio").toArray(),r=o(".loading-bar");e.forEach(function(n){n.load()}),setTimeout(function a(){var o=e.every(function(n){return n.readyState>3});o?n():(t(e.filter(function(n){return n.readyState>3}).length),setTimeout(a,100))},100)}var o=app("dom");t(),e()}}),app("page",function(){return{show:function(n){var t=app("dom");t(".active-page").removeClass("active-page").addClass("inactive-page"),t("."+n).removeClass("inactive-page").addClass("active-page");var e=app(n);e&&e.load&&e.load()}}}),app("paused-page",function(){var n=app("dom"),t=app("events"),e=app("page");n(".btn-play").on("click",function(){t.trigger("playing"),e.show("playing-page")})}),app("playing-page",function(){var n=app("dom"),t=app("page"),e=app("events");app("clock"),app("random-player"),n(".btn-reset").on("click",function(){e.trigger("reset")}),n(".btn-pause").on("click",function(){e.trigger("paused"),t.show("paused-page")}),n(".btn-edit").on("click",function(){t.show("editing-page")})}),app("random-player",function(){function n(){var o=Math.random()>.7,a=Math.floor(5e3*Math.random())+250;e(),o&&setTimeout(e,50),t(),r=setTimeout(n,a)}function t(){clearTimeout(r)}function e(){var n=a("audio"),t=Math.floor(1e3*Math.random())%n.length;i==t&&(t=++t%n.length),i=t,o(n.get(t))}function o(n){n.currentTime?n.currentTime=0:n.play()}var r,a=app("dom"),u=app("events"),i=0;return u.on("paused",t),u.on("playing",n),{play:n,pause:t}}),app("settings",function(){var n="settings",t=app("events");return{read:function(){return JSON.parse(localStorage.getItem(n)||'{ "minutes": 10 }')},update:function(e){localStorage.setItem(n,JSON.stringify(e)),t.trigger("settings-updated",e)}}}),function(){var n=app("load-audio"),t=app("page"),e=app("events");n(function(){t.show("paused-page")}),e.on("settings-updated",function(){t.show("playing-page")})}();
//# sourceMappingURL=app.js.map